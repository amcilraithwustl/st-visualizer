(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     14000,        353]
NotebookOptionsPosition[     13143,        331]
NotebookOutlinePosition[     13631,        349]
CellTagsIndexPosition[     13588,        346]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"getTransSVD", "[", 
    RowBox[{"ptsSrc_", ",", "ptsTgt_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "cent1", ",", "cent2", ",", "matP", ",", "matQ", ",", "mat", ",", "u", 
       ",", "w", ",", "v", ",", "r", ",", "func", ",", "vec"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"getting", " ", "the", " ", "centroid"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"cent1", "=", 
       RowBox[{"Mean", "[", "ptsSrc", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"cent2", "=", 
       RowBox[{"Mean", "[", "ptsTgt", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"forming", " ", "the", " ", "cross"}], "-", 
        RowBox[{"covariance", " ", "matrix"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"matP", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"#", "-", "cent1"}], ")"}], "&"}], ",", "ptsSrc"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"matQ", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"#", "-", "cent2"}], ")"}], "&"}], ",", "ptsTgt"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mat", "=", 
       RowBox[{
        RowBox[{"Transpose", "[", "matP", "]"}], ".", "matQ"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"SVD", " ", "decomposition"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"u", ",", "w", ",", "v"}], "}"}], "=", 
       RowBox[{"SingularValueDecomposition", "[", "mat", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"obtaining", " ", "the", " ", "rotation"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"r", "=", 
       RowBox[{"v", ".", 
        RowBox[{"Transpose", "[", "u", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"vec", "=", 
       RowBox[{"cent2", "-", "cent1"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", "transform", " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"func", "[", "pts_", "]"}], ":=", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"npts", ",", "nmat", ",", "ncent"}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ncent", "=", 
           RowBox[{"Mean", "[", "pts", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"nmat", "=", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"#", "-", "ncent"}], ")"}], "&"}], ",", "pts"}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"npts", "=", 
           RowBox[{"Transpose", "[", 
            RowBox[{"r", ".", 
             RowBox[{"Transpose", "[", "nmat", "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"#", "+", "vec", "+", "ncent"}], ")"}], "&"}], ",", 
            "npts"}], "]"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "func"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.853926132869824*^9, 3.853926138554863*^9}, {
   3.8539261831848326`*^9, 3.853926184346839*^9}, {3.8539263413318343`*^9, 
   3.853926341711834*^9}, {3.853926431151836*^9, 3.853926551662878*^9}, {
   3.8539266618319216`*^9, 3.853926674865904*^9}, {3.8539285448387637`*^9, 
   3.8539285870037737`*^9}, {3.8539287348027735`*^9, 
   3.8539287357897635`*^9}, {3.853928809390333*^9, 3.853928809729329*^9}, {
   3.853951321008234*^9, 3.853951321540227*^9}, {3.85439042724406*^9, 
   3.85439043442762*^9}, 3.8543904852066174`*^9, {3.854390559605045*^9, 
   3.854390575425205*^9}, {3.8543907112625246`*^9, 3.854390779128992*^9}, 
   3.8543909734234037`*^9},
 CellLabel->"In[1]:=",ExpressionUUID->"a0a94d9d-7240-44ef-80fa-2f3a33135a50"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"getTransSVD", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", "10"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", 
         RowBox[{"-", "10"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}]}], "]"}], "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"54.84781859111939`", ",", 
       RowBox[{"-", "42.93241378419822`"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "84.59177363504614`"}], ",", 
       RowBox[{"-", "34.59841543446947`"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "88.05694103679431`"}], ",", 
       RowBox[{"-", "31.598843233501782`"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"69.91824741835495`", ",", "61.53438132684062`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"16.108847932034337`", ",", "79.58446313093282`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"42.69622520990197`", ",", "42.29604120710758`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"56.23578835539951`", ",", "0.5201609259578959`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"62.09314126365956`", ",", "93.0326094329667`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"7.047474744648753`", ",", 
       RowBox[{"-", "38.433956632387265`"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "13.709137565298704`"}], ",", 
       RowBox[{"-", "22.814174140260548`"}]}], "}"}]}], "}"}], "]"}], "//", 
  "N"}]], "Input",
 CellChangeTimes->{{3.8539262070718346`*^9, 3.853926308921833*^9}, {
  3.853926350586833*^9, 3.8539263927448425`*^9}, {3.853926454740864*^9, 
  3.8539264770778885`*^9}, {3.8539265192929087`*^9, 3.8539265255958776`*^9}, {
  3.8539266804769325`*^9, 3.8539267079350214`*^9}, {3.8539268439672413`*^9, 
  3.853926844092244*^9}, {3.8539268811052413`*^9, 3.8539269361142426`*^9}, {
  3.853927028003765*^9, 3.8539270423836713`*^9}, {3.8539278165216303`*^9, 
  3.853927896545647*^9}, {3.8539283583857603`*^9, 3.8539283602017603`*^9}, {
  3.8539284500777693`*^9, 3.8539284605757604`*^9}, {3.854390530803734*^9, 
  3.8543905368133025`*^9}, {3.854390825953171*^9, 3.854390864262497*^9}, {
  3.8543910629941263`*^9, 3.8543910922661023`*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"b283d4ab-1c42-450a-935b-f0bba7944c0f"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"77.4848881369133`", ",", "26.97879485318359`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "39.06718465385649`"}], ",", "103.97535150909992`"}], "}"}],
    ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "43.639061895835646`"}], ",", "103.65479418937468`"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"26.861154132078596`", ",", 
     RowBox[{"-", "65.63689853198882`"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "27.016414539433242`"}], ",", 
     RowBox[{"-", "47.7913242834702`"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"16.62654043715598`", ",", 
     RowBox[{"-", "33.913013111130596`"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"52.52371912224378`", ",", 
     RowBox[{"-", "8.616046773509371`"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1.7021323446466692`", ",", 
     RowBox[{"-", "86.14041732407246`"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"36.545538768650175`", ",", "52.060235439617216`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"10.56837942541618`", ",", "52.018376831884325`"}], "}"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.8539264777218657`*^9, 3.8539265540998793`*^9}, {
   3.853926665141905*^9, 3.853926709307991*^9}, 3.853926844807263*^9, 
   3.8539269632882643`*^9, 3.853927043478686*^9, {3.853927838103635*^9, 
   3.85392785439867*^9}, {3.8539278883646603`*^9, 3.8539278969776382`*^9}, 
   3.8539283150970073`*^9, 3.853928361027791*^9, {3.8539284556617928`*^9, 
   3.853928461122797*^9}, {3.853928547285776*^9, 3.8539285889157825`*^9}, 
   3.8543904402511826`*^9, {3.85439048880284*^9, 3.854390493313896*^9}, 
   3.8543905383694625`*^9, {3.85439073736277*^9, 3.8543907826342325`*^9}, {
   3.8543908268869095`*^9, 3.8543908648531437`*^9}, 3.8543909773944187`*^9, 
   3.8543910089160476`*^9, {3.8543910457613277`*^9, 3.8543910927736087`*^9}, 
   3.854391348365958*^9},
 CellLabel->"Out[2]=",ExpressionUUID->"cea64bd1-dba4-4c04-826a-310bb41ab061"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"genSVDTest", " ", ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "alignSource", ",", " ", "alignTarget", ",", " ", "mapSource", ",", " ", 
      "mapTest"}], "}"}], ",", " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"alignSource", " ", "=", " ", 
      RowBox[{
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"RandomReal", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "100"}], ",", "100"}], "}"}], "]"}], ")"}], 
              "&"}], ",", 
             RowBox[{"Range", "[", "2", "]"}]}], "]"}], ")"}], "&"}], ",", 
         RowBox[{"Range", "[", "5", "]"}]}], "]"}], "//", "N"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"alignTarget", " ", "=", " ", 
      RowBox[{
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"RandomReal", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "100"}], ",", "100"}], "}"}], "]"}], ")"}], 
              "&"}], ",", 
             RowBox[{"Range", "[", "2", "]"}]}], "]"}], ")"}], "&"}], ",", 
         RowBox[{"Range", "[", "5", "]"}]}], "]"}], "//", "N"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"mapSource", " ", "=", " ", 
      RowBox[{
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"RandomReal", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "100"}], ",", "100"}], "}"}], "]"}], ")"}], 
              "&"}], ",", 
             RowBox[{"Range", "[", "2", "]"}]}], "]"}], ")"}], "&"}], ",", 
         RowBox[{"Range", "[", "50", "]"}]}], "]"}], " ", "//", "N"}]}], ";", 
     "\[IndentingNewLine]", " ", 
     RowBox[{"mapTest", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"getTransSVD", "[", 
         RowBox[{"alignSource", ",", "alignTarget"}], "]"}], "[", "mapSource",
         "]"}], "//", "N"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
      "alignSource", ",", " ", "alignTarget", ",", " ", "mapSource", ",", " ",
        "mapTest"}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.8543899302226925`*^9, 3.8543899502370358`*^9}, {
  3.8543900259149265`*^9, 3.8543901249114575`*^9}, {3.854390180482149*^9, 
  3.854390209081024*^9}, {3.8543902482669744`*^9, 3.85439040658494*^9}, {
  3.854390447094846*^9, 3.854390468774876*^9}, {3.8543905108071203`*^9, 
  3.8543905227644343`*^9}, {3.854390697728685*^9, 3.854390698989278*^9}, {
  3.8543907890792236`*^9, 3.8543908130383806`*^9}, {3.854391016919219*^9, 
  3.8543910542326508`*^9}, {3.8543910955394144`*^9, 3.8543911686020164`*^9}, {
  3.8543912039191732`*^9, 3.8543913702708406`*^9}},
 CellLabel->"In[4]:=",ExpressionUUID->"ac5dcc1c-81fa-489b-8a3f-28a66b52c4bf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"svdTests", " ", "=", " ", 
   RowBox[{"Map", "[", 
    RowBox[{"genSVDTest", ",", 
     RowBox[{"Range", "[", "10", "]"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.854391394111081*^9, 3.8543914367319384`*^9}},
 CellLabel->"In[13]:=",ExpressionUUID->"66b5d271-859d-4d54-9f95-3b6b58155048"]
},
WindowSize->{1152., 585.6},
WindowMargins->{{
  Automatic, -5.399999999999864}, {-5.399999999999977, Automatic}},
TaggingRules->Association["TryRealOnly" -> False],
FrontEndVersion->"12.3 for Microsoft Windows (64-bit) (June 19, 2021)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"f8336a59-102d-4ad8-af98-f67afadf597a"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 4271, 101, 485, "Input",ExpressionUUID->"a0a94d9d-7240-44ef-80fa-2f3a33135a50"],
Cell[CellGroupData[{
Cell[4854, 125, 2660, 64, 105, "Input",ExpressionUUID->"b283d4ab-1c42-450a-935b-f0bba7944c0f"],
Cell[7517, 191, 2020, 45, 52, "Output",ExpressionUUID->"cea64bd1-dba4-4c04-826a-310bb41ab061"]
}, Open  ]],
Cell[9552, 239, 3252, 81, 143, "Input",ExpressionUUID->"ac5dcc1c-81fa-489b-8a3f-28a66b52c4bf"],
Cell[12807, 322, 332, 7, 28, "Input",ExpressionUUID->"66b5d271-859d-4d54-9f95-3b6b58155048"]
}
]
*)

